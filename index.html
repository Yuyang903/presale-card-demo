<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>预售卡项目 - 原型设计演示</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="toggleCardType('product')">

    <!-- 顶部导航 -->
    <div class="top-nav">
        <div class="nav-logo">享乐派预售卡系统</div>
        <div class="nav-items">
            <div class="nav-item active" onclick="switchView('admin', event)">管理后台演示</div>
            <div class="nav-item" onclick="switchView('distributor', event)">分发商后台演示</div>
            <div class="nav-item" onclick="switchView('client', event)">业务流程</div>
            <a href="H5_预售卡用户端.html" target="_blank" class="nav-item" style="text-decoration: none; color: inherit;">H5预售卡用户端</a>
            <a href="BRD_预售卡项目.html" target="_blank" class="nav-item" style="text-decoration: none; color: inherit;">BRD文档</a>
            <a href="PRD_预售卡项目.html" target="_blank" class="nav-item" style="text-decoration: none; color: inherit;">PRD文档</a>
        </div>
    </div>

    <!-- 弹窗组件：关联商品 (通用) -->
    <div id="linkProductModal" class="modal-overlay" onclick="closeModal('linkProductModal', event)">
        <div class="modal">
            <div class="modal-header">
                <span id="link-product-modal-title">关联商品</span>
                <span style="cursor:pointer;" onclick="closeModal('linkProductModal')">×</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="link-product-btn-id">
                <div style="background:#fff3cd; color:#856404; padding:10px; font-size:12px; border-radius:4px; margin-bottom:15px;">
                    提示：必须关联至少一个商品供用户兑换后才能激活。
                </div>
                <div class="form-group">
                    <label id="link-product-label">可选商品池</label>
                    <div style="border: 1px solid #ddd; padding: 10px; border-radius: 4px; background: #f9f9f9;">
                        <!-- 复用已有的商品列表样式 -->
                        <div id="link-selected-products" style="margin-bottom: 10px;"></div>
                        
                        <div style="display: flex; gap: 5px;">
                            <select id="link-product-select" class="form-control" style="flex: 1;">
                                <option value="">请选择商品添加...</option>
                                <option value="周杰伦2026全新专辑 (ID: 1001)">周杰伦2026全新专辑 (ID: 1001)</option>
                                <option value="周杰伦2026全新专辑 (ID: 1002)">周杰伦2026全新专辑 (ID: 1002)</option>
                                <option value="周杰伦2026全新专辑 (ID: 1003)">周杰伦2026全新专辑 (ID: 1003)</option>
                                <option value="周杰伦历年专辑黑胶套装 (ID: 2001)">周杰伦历年专辑黑胶套装 (ID: 2001)</option>
                                <option value="周杰伦2026数字专辑 (ID: 2002)">周杰伦2026数字专辑 (ID: 2002)</option>
                                <option value="周杰伦同款奶茶杯 (ID: 2003)">周杰伦同款奶茶杯 (ID: 2003)</option>
                            </select>
                            <button class="btn btn-primary btn-sm" style="width: auto;" onclick="addLinkProduct()">添加</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('linkProductModal')">取消</button>
                <button class="btn btn-primary" onclick="saveLinkProducts()">保存关联</button>
            </div>
        </div>
    </div>

    <div class="container">
        
        <!-- 视图1：管理后台 -->
        <div id="admin-view" class="view-section active">
            <div class="admin-layout">
                <div class="admin-sidebar">
                    <div class="admin-menu-item" onclick="switchAdminTab('distributor', event)">分发商管理</div>
                    <div class="admin-menu-item active" onclick="switchAdminTab('card-product', event)">商品兑换卡</div>
                    <div class="admin-menu-item" onclick="switchAdminTab('card-points', event)">积分礼品卡</div>
                    <div class="admin-menu-item" onclick="switchAdminTab('order', event)">订单管理</div>
                    <div class="admin-menu-item" onclick="switchAdminTab('finance', event)">财务管理</div>
                    <div class="admin-menu-item" onclick="switchAdminTab('settlement', event)">结算管理</div>
                </div>
                
                <div class="admin-content">
                    
                    <!-- 商品兑换卡管理模块 -->
                    <div id="tab-card-product" class="admin-module">
                        
                        <!-- 卡片列表视图 -->
                        <div id="card-list-view-product">
                            <div class="admin-header-bar">
                                <div class="admin-title">商品兑换卡管理</div>
                                <div>
                                    <button class="btn btn-success" onclick="openCreateCardModal('product')">+ 新增制卡</button>
                                    <button class="btn btn-warning" onclick="alert('功能仅演示')">批量激活</button>
                                    <button class="btn btn-outline" onclick="alert('功能仅演示')">导出数据</button>
                                </div>
                            </div>

                            <!-- 流程指引 -->
                            <div style="margin-bottom: 15px; padding: 10px; background: #f0f7ff; border: 1px solid #cce5ff; border-radius: 4px; font-size: 12px; color: #004085; display: flex; align-items: center; flex-wrap: wrap; gap: 5px;">
                                <strong>业务流程：</strong>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">1. 制卡 (未激活)</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">2. 关联商品</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">3. 导出数据 & 生产</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">4. 激活批次</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">5. 分发</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">6. 用户兑换</span>
                            </div>

                            <div class="filter-bar">
                                <input type="text" class="form-control" placeholder="批次名称" style="width: 200px;">
                                <input type="text" class="form-control" placeholder="商品名称" style="width: 200px;">
                                <select class="form-control">
                                    <option>所有状态</option>
                                    <option>未激活</option>
                                    <option>已激活</option>
                                    <option>已作废</option>
                                </select>
                                <button class="btn btn-primary" onclick="alert('功能仅演示')">查询</button>
                            </div>

                            <div class="admin-card">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th width="40"><input type="checkbox"></th>
                                            <th>批次名称</th>
                                            <th>类型</th>
                                            <th>分发商</th>
                                            <th>内容/面额</th>
                                            <th>卡片总数</th>
                                            <th width="180">时间信息</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr data-total="200" data-remark="未激活测试批次" data-type="product">
                                            <td><input type="checkbox"></td>
                                            <td>周杰伦新专辑_自营</td>
                                            <td><span class="tag p2">商品卡</span></td>
                                            <td>直营</td>
                                            <td>周杰伦2026全新专辑</td>
                                            <td>500</td>
                                            <td style="font-size:12px; line-height:1.4;">
                                                <div style="color:#999;">生成：2023-10-01</div>
                                                <div style="color:#27ae60;">发货：2023-10-05</div>
                                            </td>
                                            <td><span class="tag p1">已激活</span></td>
                                            <td>
                                                <button class="btn btn-primary btn-sm" onclick="openEditBatchModal(this)">修改</button>
                                                <button class="btn btn-info btn-sm" onclick="openBatchDetailModal(this)">详情</button>
                                                <button class="btn btn-secondary btn-sm" onclick="showCardList(this)">卡片</button>
                                                <button class="btn btn-danger btn-sm" onclick="voidBatch(this)">作废</button>
                                            </td>
                                        </tr>
                                        <tr data-type="product">
                                            <td><input type="checkbox"></td>
                                            <td>周杰伦新专辑_杭州线下</td>
                                            <td><span class="tag p2">商品卡</span></td>
                                            <td>一直娱</td>
                                            <td>周杰伦2026全新专辑</td>
                                            <td>200</td>
                                            <td style="font-size:12px; line-height:1.4;">
                                                <div style="color:#999;">生成：2023-10-05</div>
                                                <div style="color:#27ae60;">发货：2023-10-15</div>
                                            </td>
                                            <td><span class="tag gray">未激活</span></td>
                                            <td>
                                                <button class="btn btn-success btn-sm" onclick="activateBatch(this)">激活</button>
                                                <button class="btn btn-primary btn-sm" onclick="openEditBatchModal(this)">修改</button>
                                                <button class="btn btn-info btn-sm" onclick="openBatchDetailModal(this)">详情</button>
                                                <button class="btn btn-warning btn-sm" onclick="openLinkProductModal(this)">关联商品</button>
                                                <button class="btn btn-secondary btn-sm" onclick="showCardList(this)">卡片</button>
                                                <button class="btn btn-danger btn-sm" onclick="voidBatch(this)">作废</button>
                                            </td>
                                        </tr>
                                        <tr data-total="1000" data-remark="操作失误作废" data-type="product">
                                            <td><input type="checkbox"></td>
                                            <td>周杰伦新专辑_广州线下</td>
                                            <td><span class="tag p2">商品卡</span></td>
                                            <td>一直娱</td>
                                            <td>周杰伦2026全新专辑</td>
                                            <td>1000</td>
                                            <td style="font-size:12px; line-height:1.4;">
                                                <div style="color:#999;">生成：2023-09-20 09:00</div>
                                                <div>开始：2023-09-20 00:00</div>
                                                <div style="color:#27ae60;">预计发货：2023-09-25</div>
                                            </td>
                                            <td><span class="tag p0">已作废</span></td>
                                            <td>
                                                <button class="btn btn-info btn-sm" onclick="openBatchDetailModal(this)">批次详情</button>
                                                <button class="btn btn-secondary btn-sm" onclick="showCardList(this)">卡片</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- 批次详情视图 (默认隐藏) -->
                        <div id="card-detail-view-product" style="display:none;">
                            <div class="admin-header-bar">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <button class="btn btn-outline" onclick="hideBatchDetail('product')">← 返回</button>
                                    <div class="admin-title" id="detail-batch-name-product">批次详情</div>
                                </div>
                                <div>
                                    <button class="btn btn-primary" onclick="alert('功能仅演示')">导出卡密</button>
                                </div>
                            </div>

                            <!-- 概览数据卡片 -->
                            <div style="display:flex; gap:20px; margin-bottom:20px;">
                                <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                    <div style="color:#666; font-size:14px;">总卡量</div>
                                    <div style="font-size:24px; font-weight:bold; color:var(--primary-color);" id="detail-total-count-product">500</div>
                                </div>
                                <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                    <div style="color:#666; font-size:14px;">已激活</div>
                                    <div style="font-size:24px; font-weight:bold; color:var(--success-color);" id="detail-activated-count-product">450</div>
                                </div>
                                <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                    <div style="color:#666; font-size:14px;">已使用</div>
                                    <div style="font-size:24px; font-weight:bold; color:var(--warning-color);" id="detail-used-count-product">120</div>
                                </div>
                                <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                    <div style="color:#666; font-size:14px;">已作废</div>
                                    <div style="font-size:24px; font-weight:bold; color:var(--danger-color);" id="detail-void-count-product">5</div>
                                </div>
                            </div>

                            <div class="admin-card">
                                <div style="margin-bottom:15px; font-weight:bold; border-bottom:1px solid #eee; padding-bottom:10px;">本批次卡片列表</div>
                                <div class="filter-bar" style="margin-bottom:15px; padding:10px;">
                                    <input type="text" class="form-control" placeholder="搜索卡号" style="width: 200px;">
                                    <select class="form-control">
                                        <option>状态筛选</option>
                                        <option>未激活</option>
                                        <option>已激活</option>
                                        <option>已使用</option>
                                    </select>
                                    <button class="btn btn-primary btn-sm">搜索</button>
                                    <button class="btn btn-outline btn-sm">导出Excel</button>
                                </div>
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>卡号</th>
                                            <th>兑换链接</th>
                                            <th>状态</th>
                                            <th>生成时间</th>
                                            <th>兑换时间</th>
                                            <th>订单号</th>
                                            <th>商品</th>
                                            <th>发货状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>VIP-20231027-001</td>
                                            <td><a href="#" style="color:#3498db; text-decoration:none;">https://xle.com/c/x8s7...</a></td>
                                            <td><span class="tag p1">已激活</span></td>
                                            <td>2023-10-01 10:00</td>
                                            <td>-</td>
                                            <td><span style="color:#999;">未使用</span></td>
                                            <td>周杰伦2026全新专辑</td>
                                            <td><span style="color:#999;">未使用</span></td>
                                            <td><button class="btn btn-danger btn-sm">作废</button></td>
                                        </tr>
                                        <tr>
                                            <td>VIP-20231027-002</td>
                                            <td><a href="#" style="color:#3498db; text-decoration:none;">https://xle.com/c/k92a...</a></td>
                                            <td><span class="tag p2">已使用</span></td>
                                            <td>2023-10-01 10:00</td>
                                            <td>2023-10-15 14:30</td>
                                            <td>ORD-20231015-001</td>
                                            <td>周杰伦2026全新专辑</td>
                                            <td><span class="tag p2">已发货</span></td>
                                            <td><button class="btn btn-secondary btn-sm" onclick="openModal('orderDetailModal')">订单详情</button></td>
                                        </tr>
                                        <tr>
                                            <td>VIP-20231027-004</td>
                                            <td><a href="#" style="color:#3498db; text-decoration:none;">https://xle.com/c/m3d9...</a></td>
                                            <td><span class="tag gray">未激活</span></td>
                                            <td>2023-10-01 10:00</td>
                                            <td>-</td>
                                            <td><span style="color:#999;">未使用</span></td>
                                            <td>周杰伦2026全新专辑</td>
                                            <td><span style="color:#999;">未使用</span></td>
                                            <td><button class="btn btn-success btn-sm">激活</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    <!-- 积分礼品卡管理模块 -->
                    <div id="tab-card-points" class="admin-module" style="display:none;">
                        
                        <!-- 卡片列表视图 -->
                        <div id="card-list-view-points">
                            <div class="admin-header-bar">
                                <div class="admin-title">积分礼品卡管理</div>
                                <div>
                                    <button class="btn btn-success" onclick="openCreateCardModal('points')">+ 新增制卡</button>
                                    <button class="btn btn-warning" onclick="alert('功能仅演示')">批量激活</button>
                                    <button class="btn btn-outline" onclick="alert('功能仅演示')">导出数据</button>
                                </div>
                            </div>

                             <!-- 流程指引 -->
                            <div style="margin-bottom: 15px; padding: 10px; background: #f0f7ff; border: 1px solid #cce5ff; border-radius: 4px; font-size: 12px; color: #004085; display: flex; align-items: center; flex-wrap: wrap; gap: 5px;">
                                <strong>业务流程：</strong>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">1. 制卡 (未激活)</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">2. 关联商品池</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">3. 导出数据 & 生产</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">4. 激活批次</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">5. 分发</span>
                                <span style="color:#666;">→</span>
                                <span style="background:#fff; padding:2px 6px; border-radius:3px; border:1px solid #b8daff;">6. 用户兑换</span>
                            </div>

                            <div class="filter-bar">
                                <input type="text" class="form-control" placeholder="批次名称" style="width: 200px;">
                                <input type="number" class="form-control" placeholder="面额" style="width: 200px;">
                                <select class="form-control">
                                    <option>所有状态</option>
                                    <option>未激活</option>
                                    <option>已激活</option>
                                    <option>已作废</option>
                                </select>
                                <button class="btn btn-primary" onclick="alert('功能仅演示')">查询</button>
                            </div>

                            <div class="admin-card">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th width="40"><input type="checkbox"></th>
                                            <th>批次名称</th>
                                            <th>类型</th>
                                            <th>分发商</th>
                                            <th>内容/面额</th>
                                            <th>卡片总数</th>
                                            <th width="180">时间信息</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr data-type="points">
                                            <td><input type="checkbox"></td>
                                            <td>企业积分卡_批次C</td>
                                            <td><span class="tag" style="background:#9b59b6;">积分卡</span></td>
                                            <td>一直娱 (7折)</td>
                                            <td>300 积分</td>
                                            <td>1000</td>
                                            <td style="font-size:12px; line-height:1.4;">
                                                <div style="color:#999;">生成：2023-11-01</div>
                                                <div style="color:#27ae60;">发货：2023-11-05</div>
                                            </td>
                                            <td><span class="tag p1">已激活</span></td>
                                            <td>
                                                <button class="btn btn-primary btn-sm" onclick="openEditBatchModal(this)">修改</button>
                                                <button class="btn btn-info btn-sm" onclick="openBatchDetailModal(this)">详情</button>
                                                <button class="btn btn-secondary btn-sm" onclick="showCardList(this)">卡片</button>
                                                <button class="btn btn-danger btn-sm" onclick="voidBatch(this)">作废</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- 批次详情视图 (默认隐藏) -->
                        <div id="card-detail-view-points" style="display:none;">
                            <div class="admin-header-bar">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <button class="btn btn-outline" onclick="hideBatchDetail('points')">← 返回</button>
                                    <div class="admin-title" id="detail-batch-name-points">批次详情</div>
                                </div>
                                <div>
                                    <button class="btn btn-primary" onclick="alert('功能仅演示')">导出卡密</button>
                                </div>
                            </div>

                            <!-- 概览数据卡片 -->
                            <div style="display:flex; gap:20px; margin-bottom:20px;">
                                <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                    <div style="color:#666; font-size:14px;">总卡量</div>
                                    <div style="font-size:24px; font-weight:bold; color:var(--primary-color);" id="detail-total-count-points">0</div>
                                </div>
                                <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                    <div style="color:#666; font-size:14px;">已激活</div>
                                    <div style="font-size:24px; font-weight:bold; color:var(--success-color);" id="detail-activated-count-points">0</div>
                                </div>
                                <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                    <div style="color:#666; font-size:14px;">已使用</div>
                                    <div style="font-size:24px; font-weight:bold; color:var(--warning-color);" id="detail-used-count-points">0</div>
                                </div>
                                <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                    <div style="color:#666; font-size:14px;">已作废</div>
                                    <div style="font-size:24px; font-weight:bold; color:var(--danger-color);" id="detail-void-count-points">0</div>
                                </div>
                            </div>

                            <div class="admin-card">
                                <div style="margin-bottom:15px; font-weight:bold; border-bottom:1px solid #eee; padding-bottom:10px;">本批次卡片列表</div>
                                <div class="filter-bar" style="margin-bottom:15px; padding:10px;">
                                    <input type="text" class="form-control" placeholder="搜索卡号" style="width: 200px;">
                                    <select class="form-control">
                                        <option>状态筛选</option>
                                        <option>未激活</option>
                                        <option>已激活</option>
                                        <option>已使用</option>
                                    </select>
                                    <button class="btn btn-primary btn-sm">搜索</button>
                                    <button class="btn btn-outline btn-sm">导出Excel</button>
                                </div>
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>卡号</th>
                                            <th>兑换链接</th>
                                            <th>状态</th>
                                            <th>生成时间</th>
                                            <th>兑换时间</th>
                                            <th>订单号</th>
                                            <th>内容</th>
                                            <th>发货状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Placeholder for points card details -->
                                        <tr>
                                            <td colspan="9" style="text-align:center; padding:20px; color:#999;">暂无数据 (演示)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    <!-- 分发商管理模块 -->
                    <div id="tab-distributor" class="admin-module" style="display:none;">
                        <div class="admin-header-bar">
                            <div class="admin-title">分发商管理</div>
                            <button class="btn btn-success" onclick="openModal('editDistributorModal'); resetDistributorForm();">+ 新增分发商</button>
                        </div>
                        
                        <div class="admin-card">
                            <table class="admin-table" id="distributor-table">
                                <thead>
                                    <tr>
                                        <th>分发商名称</th>
                                        <th>类型</th>
                                        <th>联系人</th>
                                        <th>联系电话</th>
                                        <th>合作状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-id="d0" data-type="self_operated">
                                        <td>享乐派直营</td>
                                        <td><span class="tag p1">自营</span></td>
                                        <td>运营部</td>
                                        <td>020-88888888</td>
                                        <td><span class="tag p1">合作中</span></td>
                                        <td>
                                            <button class="btn btn-primary btn-sm" onclick="editDistributor(this)">编辑</button>
                                            <button class="btn btn-danger btn-sm" onclick="toggleDistributorStatus(this)">停用</button>
                                        </td>
                                    </tr>
                                    <tr data-id="d1" data-type="distribution">
                                        <td>一直娱</td>
                                        <td><span class="tag p2">分销</span></td>
                                        <td>张经理</td>
                                        <td>13812345678</td>
                                        <td><span class="tag p1">合作中</span></td>
                                        <td>
                                            <button class="btn btn-primary btn-sm" onclick="editDistributor(this)">编辑</button>
                                            <button class="btn btn-danger btn-sm" onclick="toggleDistributorStatus(this)">停用</button>
                                        </td>
                                    </tr>
                                    <tr data-id="d2" data-type="distribution">
                                        <td>一直娱 (广州)</td>
                                        <td><span class="tag p2">分销</span></td>
                                        <td>陈总</td>
                                        <td>13987654321</td>
                                        <td><span class="tag p1">合作中</span></td>
                                        <td>
                                            <button class="btn btn-primary btn-sm" onclick="editDistributor(this)">编辑</button>
                                            <button class="btn btn-danger btn-sm" onclick="toggleDistributorStatus(this)">停用</button>
                                        </td>
                                    </tr>
                                    <tr data-id="d3" data-type="dealership">
                                        <td>天沐</td>
                                        <td><span class="tag" style="background:#8e44ad;">经销</span></td>
                                        <td>李总</td>
                                        <td>13500000000</td>
                                        <td><span class="tag p1">合作中</span></td>
                                        <td>
                                            <button class="btn btn-primary btn-sm" onclick="editDistributor(this)">编辑</button>
                                            <button class="btn btn-danger btn-sm" onclick="toggleDistributorStatus(this)">停用</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 订单管理模块 -->
                    <div id="tab-order" class="admin-module" style="display:none;">
                        <div class="admin-header-bar">
                            <div class="admin-title">订单管理</div>
                            <button class="btn btn-outline" onclick="alert('功能仅演示')">批量导出发货单</button>
                        </div>
                        
                        <!-- 订单类型Tab -->
                        <div style="display:flex; gap:30px; border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px;">
                            <div id="ot-presale" class="order-tab active" onclick="switchOrderTab('presale')" style="font-weight:bold; color:var(--primary-color); border-bottom:2px solid var(--primary-color); padding-bottom:5px; cursor:pointer;">商品兑换卡订单</div>
                            <div id="ot-gift" class="order-tab" onclick="switchOrderTab('gift')" style="color:#666; cursor:pointer; padding-bottom:5px;">积分礼品卡订单</div>
                        </div>

                        <!-- 1. 预售卡订单视图 -->
                        <div id="order-presale-view">
                            <div class="filter-bar" style="flex-wrap: wrap; gap: 10px;">
                                <input type="text" class="form-control" placeholder="订单号" style="width: 150px;">
                                <input type="text" class="form-control" placeholder="卡批次" style="width: 150px;">
                                <input type="text" class="form-control" placeholder="商品名称" style="width: 150px;">
                                <input type="text" class="form-control" placeholder="SKU编码" style="width: 120px;">
                                <input type="text" class="form-control" placeholder="收货人" style="width: 120px;">
                                <input type="text" class="form-control" placeholder="手机号" style="width: 120px;">
                                <div style="display:flex; align-items:center; gap:5px; color:#666; font-size:12px;">
                                    <span>发货日期:</span>
                                    <input type="date" class="form-control" style="width: 130px;">
                                    <span>-</span>
                                    <input type="date" class="form-control" style="width: 130px;">
                                </div>
                                <select class="form-control" style="width: 120px;">
                                    <option>所有状态</option>
                                    <option>待发货</option>
                                    <option>已发货</option>
                                </select>
                                <button class="btn btn-primary" onclick="alert('功能仅演示')">查询</button>
                            </div>

                            <div class="admin-card">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>订单号</th>
                                            <th>关联卡号</th>
                                            <th>商品信息</th>
                                            <th>SKU编码</th>
                                            <th>收货人</th>
                                            <th>发货时间</th>
                                            <th>物流状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>ORD-20231027-001</td>
                                            <td>VIP-002</td>
                                            <td>周杰伦2026全新专辑 (精装版) x1</td>
                                            <td>SKU-JAY-001</td>
                                            <td>张三 (13800000000)<br><span style="color:#999;font-size:12px;">北京市朝阳区...</span></td>
                                            <td>-</td>
                                            <td><span class="tag p1">待发货</span></td>
                                            <td><button class="btn btn-secondary" onclick="openModal('orderDetailModal')">详情</button></td>
                                        </tr>
                                        <tr>
                                            <td>ORD-20231026-055</td>
                                            <td>VIP-099</td>
                                            <td>周杰伦2026全新专辑 (平装版) x1</td>
                                            <td>SKU-JAY-002</td>
                                            <td>李四 (13900000000)<br><span style="color:#999;font-size:12px;">上海市浦东新区...</span></td>
                                            <td>2023-10-27 09:00</td>
                                            <td><span class="tag p2">已发货</span></td>
                                            <td><button class="btn btn-secondary" onclick="openModal('orderDetailModal')">详情</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 2. 礼品卡订单视图 -->
                        <div id="order-gift-view" style="display:none;">
                            <div class="filter-bar" style="flex-wrap: wrap; gap: 10px;">
                                <input type="text" class="form-control" placeholder="订单号" style="width: 150px;">
                                <input type="text" class="form-control" placeholder="支付卡号" style="width: 150px;">
                                <input type="text" class="form-control" placeholder="SKU编码" style="width: 120px;">
                                <input type="text" class="form-control" placeholder="收货人" style="width: 120px;">
                                <div style="display:flex; align-items:center; gap:5px; color:#666; font-size:12px;">
                                    <span>发货日期:</span>
                                    <input type="date" class="form-control" style="width: 130px;">
                                    <span>-</span>
                                    <input type="date" class="form-control" style="width: 130px;">
                                </div>
                                <select class="form-control" style="width: 120px;">
                                    <option>所有状态</option>
                                    <option>待发货</option>
                                    <option>已发货</option>
                                </select>
                                <button class="btn btn-primary" onclick="alert('功能仅演示')">查询</button>
                            </div>

                            <div class="admin-card">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>订单号</th>
                                            <th>支付卡号</th>
                                            <th>消耗积分</th>
                                            <th>商品明细</th>
                                            <th>SKU编码</th>
                                            <th>收货人</th>
                                            <th>发货时间</th>
                                            <th>物流状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>MALL-20231115-008</td>
                                            <td>GIFT-888</td>
                                            <td style="color:var(--warning-color); font-weight:bold;">300</td>
                                            <td>
                                                <div>周杰伦历年专辑黑胶套装 x1</div>
                                            </td>
                                            <td>SKU-VINYL-JAY</td>
                                            <td>王五 (13766668888)</td>
                                            <td>-</td>
                                            <td><span class="tag p1">待发货</span></td>
                                            <td><button class="btn btn-secondary" onclick="openModal('orderDetailModal')">详情</button></td>
                                        </tr>
                                        <tr>
                                            <td>MALL-20231112-023</td>
                                            <td>GIFT-999</td>
                                            <td style="color:var(--warning-color); font-weight:bold;">150</td>
                                            <td>
                                                <div>周杰伦同款奶茶杯 x1</div>
                                            </td>
                                            <td>SKU-CUP-JAY</td>
                                            <td>赵六 (13612341234)</td>
                                            <td>2023-11-13 10:30</td>
                                            <td><span class="tag p2">已发货</span></td>
                                            <td><button class="btn btn-secondary" onclick="openModal('orderDetailModal')">详情</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    <!-- 财务管理模块 -->
                    <div id="tab-finance" class="admin-module" style="display:none;">
                        <div class="admin-header-bar">
                            <div class="admin-title">财务管理</div>
                        </div>
                        
                        <div class="admin-card" style="margin-bottom: 20px;">
                            <!-- 财务子Tab -->
                            <div style="display:flex; gap:30px; border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px;">
                                <div id="ft-income" class="finance-tab active" onclick="switchFinanceTab('income')" style="font-weight:bold; color:var(--primary-color); border-bottom:2px solid var(--primary-color); padding-bottom:5px; cursor:pointer;">经销管理</div>
                                <div id="ft-channel" class="finance-tab" onclick="switchFinanceTab('channel')" style="color:#666; cursor:pointer; padding-bottom:5px;">分销管理</div>
                                <div id="ft-cost" class="finance-tab" onclick="switchFinanceTab('cost')" style="color:#666; cursor:pointer; padding-bottom:5px;">制卡成本</div>
                                <div id="ft-overview" class="finance-tab" onclick="switchFinanceTab('overview')" style="color:#666; cursor:pointer; padding-bottom:5px;">收支概览</div>
                            </div>
                            
                            <!-- 1. 收款记录视图 -->
                            <div id="finance-income-view">
                                <div style="margin-bottom:15px; text-align:right;">
                                    <button class="btn btn-success" onclick="openModal('createIncomeModal')">+ 新增订单</button>
                                </div>
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>收款日期</th>
                                            <th>客户名称</th>
                                            <th>购买内容</th>
                                            <th>实收金额</th>
                                            <th>已开票金额</th>
                                            <th>未开票金额</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr data-id="inc-001" data-amount="15000" data-invoiced="10000">
                                            <td>2023-10-25</td>
                                            <td>一直娱</td>
                                            <td>周杰伦新专辑_自营 x 50张</td>
                                            <td style="font-weight:bold; color:var(--danger-color);">¥ 15,000.00</td>
                                            <td style="color:#27ae60;">¥ 10,000.00</td>
                                            <td style="color:#e74c3c; font-weight:bold;">¥ 5,000.00</td>
                                            <td>
                                                <button class="btn btn-primary btn-sm" onclick="openInvoiceModal(this)">开票</button>
                                                <button class="btn btn-info btn-sm" onclick="openInvoiceDetailModal(this)">明细</button>
                                            </td>
                                        </tr>
                                        <tr data-id="inc-002" data-amount="600" data-invoiced="0">
                                            <td>2023-10-26</td>
                                            <td>李先生</td>
                                            <td>周杰伦新专辑_自营 x 2张</td>
                                            <td style="font-weight:bold; color:var(--danger-color);">¥ 600.00</td>
                                            <td style="color:#27ae60;">¥ 0.00</td>
                                            <td style="color:#e74c3c; font-weight:bold;">¥ 600.00</td>
                                            <td>
                                                <button class="btn btn-primary btn-sm" onclick="openInvoiceModal(this)">开票</button>
                                                <button class="btn btn-info btn-sm" onclick="openInvoiceDetailModal(this)">明细</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr style="background:#f9f9f9; font-weight:bold;">
                                            <td colspan="3" style="text-align:right;">合计：</td>
                                            <td style="color:var(--danger-color);">¥ 15,600.00</td>
                                            <td style="color:#27ae60;">¥ 10,000.00</td>
                                            <td style="color:#e74c3c;">¥ 5,600.00</td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <!-- 4. 分销渠道账单视图 (New) -->
                            <div id="finance-channel-view" style="display:none;">
                                <div class="filter-bar" style="display:flex; justify-content: space-between; align-items: center;">
                                    <div style="display:flex; gap:10px;">
                                        <select class="form-control" style="width: 150px;">
                                            <option>所有分发商</option>
                                            <option>一直娱 (分销)</option>
                                            <option>一直娱 (广州) (分销)</option>
                                        </select>
                                        <input type="text" class="form-control" placeholder="批次名称" style="width: 180px;">
                                        <button class="btn btn-primary" onclick="alert('功能仅演示')">查询</button>
                                    </div>
                                    <div>
                                        <button class="btn btn-success" onclick="openModal('createIssuanceModal')">+ 新增发卡记录</button>
                                    </div>
                                </div>
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>发卡日期</th>
                                            <th>分发商 (类型)</th>
                                            <th>关联批次</th>
                                            <th>发卡数量</th>
                                            <th>卡片总金额 (面额)</th>
                                            <th>已结算金额</th>
                                            <th>已结算渠道费</th>
                                            <th>兑换状态 (已兑/未兑)</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr data-id="ch-001">
                                            <td>2023-10-01</td>
                                            <td>一直娱 <span class="tag p2">分销</span></td>
                                            <td>周杰伦新专辑_自营</td>
                                            <td>500 张</td>
                                            <td style="font-weight:bold;">¥ 150,000.00</td>
                                            <td style="color:#27ae60;">¥ 100,000.00</td>
                                            <td style="color:#e67e22;">¥ 5,000.00</td>
                                            <td>
                                                <span style="color:#27ae60;">450</span> / <span style="color:#999;">50</span>
                                            </td>
                                            <td>
                                                <button class="btn btn-warning btn-sm" onclick="openSettlementModal(this)">新增结算记录</button>
                                                <button class="btn btn-info btn-sm" onclick="alert('查看结算明细')">明细</button>
                                            </td>
                                        </tr>
                                        <tr data-id="ch-002">
                                            <td>2023-10-05</td>
                                            <td>一直娱 (广州) <span class="tag p2">分销</span></td>
                                            <td>周杰伦新专辑_杭州线下</td>
                                            <td>200 张</td>
                                            <td style="font-weight:bold;">¥ 60,000.00</td>
                                            <td style="color:#27ae60;">¥ 50,000.00</td>
                                            <td style="color:#e67e22;">¥ 0.00</td>
                                            <td>
                                                <span style="color:#27ae60;">120</span> / <span style="color:#999;">80</span>
                                            </td>
                                            <td>
                                                <button class="btn btn-warning btn-sm" onclick="openSettlementModal(this)">新增结算记录</button>
                                                <button class="btn btn-info btn-sm" onclick="alert('查看结算明细')">明细</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 2. 制卡成本视图 -->
                            <div id="finance-cost-view" style="display:none;">
                                <div style="margin-bottom:15px; text-align:right;">
                                    <button class="btn btn-warning" onclick="alert('功能仅演示')">+ 登记成本</button>
                                </div>
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>登记日期</th>
                                            <th>批次名称</th>
                                            <th>供应商</th>
                                            <th>制卡数量</th>
                                            <th>总成本</th>
                                            <th>单张成本</th>
                                            <th>经手人</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>2023-09-28</td>
                                            <td>周杰伦新专辑_自营</td>
                                            <td>xx印刷厂</td>
                                            <td>500</td>
                                            <td style="font-weight:bold; color:var(--primary-color);">¥ 2,500.00</td>
                                            <td>¥ 5.00</td>
                                            <td>采购部</td>
                                        </tr>
                                        <tr>
                                            <td>2023-10-02</td>
                                            <td>周杰伦新专辑_杭州线下</td>
                                            <td>xx印刷厂</td>
                                            <td>200</td>
                                            <td style="font-weight:bold; color:var(--primary-color);">¥ 1,200.00</td>
                                            <td>¥ 6.00</td>
                                            <td>采购部</td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr style="background:#f9f9f9; font-weight:bold;">
                                            <td colspan="4" style="text-align:right;">合计支出：</td>
                                            <td colspan="3" style="color:var(--primary-color);">¥ 3,700.00</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <!-- 3. 收支概览视图 -->
                            <div id="finance-overview-view" style="display:none; text-align:center; padding:50px; color:#999;">
                                暂无概览数据图表
                            </div>
                        </div>
                    </div>

                    <!-- 结算管理模块 -->
                    <div id="tab-settlement" class="admin-module" style="display:none;">
                        <div class="admin-header-bar">
                            <div class="admin-title">结算管理</div>
                        </div>
                        
                        <div class="filter-bar">
                            <select class="form-control">
                                <option>所有分发商</option>
                                <option>一直娱</option>
                                <option>一直娱 (广州)</option>
                            </select>
                            <input type="month" class="form-control">
                            <button class="btn btn-primary" onclick="alert('功能仅演示')">查询</button>
                            <button class="btn btn-outline" onclick="alert('功能仅演示')">导出对账单</button>
                        </div>

                        <div class="admin-card">
                            <h4 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">分发商对账单 (2023年10月)</h4>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>分发商</th>
                                        <th>发货订单数</th>
                                        <th>商品总价值</th>
                                        <th>结算折扣</th>
                                        <th>应结算金额</th>
                                        <th>结算状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>一直娱</td>
                                        <td>120</td>
                                        <td>¥ 36,000.00</td>
                                        <td>70%</td>
                                        <td style="font-weight:bold; color:var(--danger-color);">¥ 25,200.00</td>
                                        <td><span class="tag p0">未结算</span></td>
                                        <td>
                                            <button class="btn btn-success btn-sm">标记结算</button>
                                            <button class="btn btn-info btn-sm">明细</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>一直娱 (广州)</td>
                                        <td>50</td>
                                        <td>¥ 15,000.00</td>
                                        <td>85%</td>
                                        <td style="font-weight:bold; color:var(--danger-color);">¥ 12,750.00</td>
                                        <td><span class="tag p1">已结算</span></td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" disabled>标记结算</button>
                                            <button class="btn btn-info btn-sm">明细</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- 视图2：分发商后台 -->
        <div id="distributor-view" class="view-section">
            <div class="admin-layout">
                <div class="admin-sidebar" style="background: #2c3e50;">
                    <div style="padding: 20px; color: #fff; font-size: 14px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div style="font-weight:bold; font-size:16px;">分发商门户</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">当前：一直娱</div>
                    </div>
                    <div class="distributor-menu-item active" onclick="switchDistributorTab('dashboard', event)" style="padding:15px 20px; color:rgba(255,255,255,0.7); cursor:pointer;">数据概览</div>
                    <div class="distributor-menu-item" onclick="switchDistributorTab('orders', event)" style="padding:15px 20px; color:rgba(255,255,255,0.7); cursor:pointer;">兑换订单</div>
                    <div class="distributor-menu-item" onclick="switchDistributorTab('finance', event)" style="padding:15px 20px; color:rgba(255,255,255,0.7); cursor:pointer;">财务结算</div>
                </div>
                
                <div class="admin-content">
                    
                    <!-- 1. 数据概览 -->
                    <div id="dist-tab-dashboard" class="distributor-module">
                        <div class="admin-header-bar">
                            <div class="admin-title">一直娱 - 数据概览</div>
                        </div>
                        <div style="display:flex; gap:20px; margin-bottom:20px;">
                            <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                <div style="color:#666; font-size:14px;">持有卡片总数</div>
                                <div style="font-size:24px; font-weight:bold; color:var(--primary-color);">1,000</div>
                            </div>
                            <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                <div style="color:#666; font-size:14px;">已结算卡片</div>
                                <div style="font-size:24px; font-weight:bold; color:var(--success-color);">850</div>
                            </div>
                            <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                <div style="color:#666; font-size:14px;">累计结算金额</div>
                                <div style="font-size:24px; font-weight:bold; color:var(--warning-color);">¥ 255,000.00</div>
                            </div>
                            <div class="admin-card" style="flex:1; margin-bottom:0; text-align:center; padding:15px;">
                                <div style="color:#666; font-size:14px;">累计渠道费用</div>
                                <div style="font-size:24px; font-weight:bold; color:#17a2b8;">¥ 55,000.00</div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. 兑换订单 -->
                    <div id="dist-tab-orders" class="distributor-module" style="display:none;">
                        <div class="admin-header-bar">
                            <div class="admin-title">用户兑换订单</div>
                        </div>
                        <div class="filter-bar">
                            <input type="text" class="form-control" placeholder="卡号/订单号" style="width: 200px;">
                            <select class="form-control">
                                <option>所有状态</option>
                                <option>待发货</option>
                                <option>已发货</option>
                            </select>
                            <button class="btn btn-primary" onclick="alert('功能仅演示')">查询</button>
                        </div>
                        <div class="admin-card">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>订单号</th>
                                        <th>关联卡号</th>
                                        <th>商品信息</th>
                                        <th>兑换时间</th>
                                        <th>发货状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>ORD-20231027-001</td>
                                        <td>VIP-002</td>
                                        <td>豪华月饼礼盒</td>
                                        <td>2023-10-27 10:00</td>
                                        <td><span class="tag p1">待发货</span></td>
                                    </tr>
                                    <tr>
                                        <td>ORD-20231026-055</td>
                                        <td>VIP-099</td>
                                        <td>坚果大礼包</td>
                                        <td>2023-10-26 14:30</td>
                                        <td><span class="tag p2">已发货</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 3. 财务结算 -->
                    <div id="dist-tab-finance" class="distributor-module" style="display:none;">
                        <div class="admin-header-bar">
                            <div class="admin-title">财务结算记录</div>
                        </div>
                        <div class="admin-card">
                            <div style="margin-bottom:15px; font-weight:bold; border-bottom:1px solid #eee; padding-bottom:10px;">卡片分发记录</div>
                            <table class="admin-table" style="margin-bottom:30px;">
                                <thead>
                                    <tr>
                                        <th>日期</th>
                                        <th>批次名称</th>
                                        <th>数量</th>
                                        <th>卡片面额</th>
                                        <th>卡片总金额</th>
                                        <th>已结算金额</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2023-10-01</td>
                                        <td>周杰伦新专辑_自营</td>
                                        <td>500</td>
                                        <td style="font-weight:bold; color:var(--danger-color);">¥ 300.00</td>
                                        <td style="font-weight:bold;">¥ 150,000.00</td>
                                        <td style="color:var(--success-color);">¥ 0.00</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div style="margin-bottom:15px; font-weight:bold; border-bottom:1px solid #eee; padding-bottom:10px;">结算记录</div>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>结算月份</th>
                                        <th>售卡数量</th>
                                        <th>卡片面额</th>
                                        <th>结算折扣</th>
                                        <th>渠道费用金额</th>
                                        <th>应结算金额</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2023-10</td>
                                        <td>120</td>
                                        <td>¥ 300.00</td>
                                        <td>70%</td>
                                        <td style="font-weight:bold; color:#17a2b8;">¥ 10,800.00</td>
                                        <td style="font-weight:bold; color:var(--success-color);">¥ 25,200.00</td>
                                        <td><span class="tag p0">未结算</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    


                </div>
            </div>
        </div>

        <!-- 视图2：用户端H5 -->
        <div id="client-view" class="view-section" style="flex-direction: column; padding: 40px; background: #f4f6f9; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 40px; color: #2c3e50;">预售卡业务全景流程图</h2>
            
            <div style="display:flex; flex-direction:column; gap:40px; margin-bottom: 60px;">
                <!-- 1. 分销流程 -->
                <div style="background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                    <h3 style="margin-top:0; color:#3498db; border-bottom:2px solid #3498db; padding-bottom:10px; display:inline-block;">A. 分销流程 (代销/返佣)</h3>
                    <div style="display: flex; justify-content: flex-start; align-items: flex-start; gap: 15px; flex-wrap: wrap; margin-top:20px;">
                        <div class="flow-step">
                            <div class="step-icon">📝</div>
                            <div class="step-title">1. 登记发卡记录</div>
                            <div class="step-desc">后台登记给分发商发了多少数量卡片</div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-icon">🚚</div>
                            <div class="step-title">2. 分发商销售</div>
                            <div class="step-desc">分销商销售卡片</div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-icon">📱</div>
                            <div class="step-title">3. 统计&结算</div>
                            <div class="step-desc">• 我方收款：<br>我方统计销售数据，支付渠道费给对方<br>
                                • 对方收款：<br>对方提供销售数据，扣除渠道费后结算给我方</div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-icon">💰</div>
                            <div class="step-title">4. 开票</div>
                            <div class="step-desc" style="text-align:left; font-size:11px;">
                                对方开票，业务上传后台
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. 经销流程 -->
                <div style="background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                    <h3 style="margin-top:0; color:#8e44ad; border-bottom:2px solid #8e44ad; padding-bottom:10px; display:inline-block;">B. 经销流程 (买断/批发)</h3>
                    <div style="display: flex; justify-content: flex-start; align-items: flex-start; gap: 15px; flex-wrap: wrap; margin-top:20px;">
                        <div class="flow-step">
                            <div class="step-icon">💴</div>
                            <div class="step-title">1. 创建订单</div>
                            <div class="step-desc">后台录入订单<br>分发商、卡片批次、数量</div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-icon">🖥️</div>
                            <div class="step-title">2. 付款</div>
                            <div class="step-desc">经销商付款，对公转账</div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-icon">📦</div>
                            <div class="step-title">3. 发货 (卡)</div>
                            <div class="step-desc">交付实体卡给经销商</div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-icon">🧾</div>
                            <div class="step-title">4. 开票</div>
                            <div class="step-desc">财务根据订单<br>开具发票</div>
                        </div>
                        <div class="flow-arrow" style="color:#ccc;">...</div>
                        <div class="flow-step" style="opacity:0.7;">
                            <div class="step-icon">🔄</div>
                            <div class="step-title">后续流程</div>
                            <div class="step-desc">经销商自行销售<br>用户兑换/我方履约</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 原有通用流程 (保留作为参考或折叠) -->
            <div style="opacity:0.6; transform:scale(0.9);">
                <h4 style="text-align:center; color:#999;">(参考) 通用业务环节</h4>
                <div style="display: flex; justify-content: center; align-items: flex-start; gap: 20px; flex-wrap: wrap;">
                
                <!-- Step 1: Distributor -->
                <div class="flow-step">
                    <div class="step-icon">🏢</div>
                    <div class="step-title">1. 创建分发商</div>
                    <div class="step-desc">录入分发商信息<br>设置合作状态</div>
                </div>

                <div class="flow-arrow">→</div>

                <!-- Step 2: Create Batch -->
                <div class="flow-step">
                    <div class="step-icon">📝</div>
                    <div class="step-title">2. 创建批次</div>
                    <div class="step-desc">选择卡类型 (商品/积分)<br>设置数量与面额</div>
                </div>

                <div class="flow-arrow">→</div>

                <!-- Step 3: Link Product -->
                <div class="flow-step">
                    <div class="step-icon">🔗</div>
                    <div class="step-title">3. 关联商品</div>
                    <div class="step-desc">绑定可兑换商品池</div>
                </div>

                <div class="flow-arrow">→</div>

                <!-- Step 4: Activate -->
                <div class="flow-step">
                    <div class="step-icon">✅</div>
                    <div class="step-title">4. 激活批次</div>
                    <div class="step-desc">确认无误后激活<br>生成正式卡密</div>
                </div>

                <div class="flow-arrow">→</div>

                <!-- Step 5: Produce -->
                <div class="flow-step">
                    <div class="step-icon">🏭</div>
                    <div class="step-title">5. 生产</div>
                    <div class="step-desc">导出卡密，生产卡片</div>
                </div>

                <div class="flow-arrow">→</div>

                <!-- Step 6: Distribute -->
                <div class="flow-step">
                    <div class="step-icon">🚚</div>
                    <div class="step-title">6. 分发/销售</div>
                    <div class="step-desc">分发商/售卖机销售卡片，或线上直接销售</div>
                </div>

                <div class="flow-arrow">→</div>

                <!-- Step 7: User Redeem -->
                <div class="flow-step">
                    <div class="step-icon">📱</div>
                    <div class="step-title">7. 用户兑换</div>
                    <div class="step-desc">扫码填写地址兑换商品</div>
                </div>

                <div class="flow-arrow">→</div>

                <!-- Step 8: Ship -->
                <div class="flow-step">
                    <div class="step-icon">📦</div>
                    <div class="step-title">8. 发货履约</div>
                    <div class="step-desc">商家后台处理订单<br>物流发货</div>
                </div>

            </div>
            </div>

            <!-- Card Preview -->
            <div style="margin-top: 60px; display: flex; justify-content: center; flex-direction: column; align-items: center;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">实体卡样卡预览</h3>
                
                <div style="display: flex; gap: 40px; flex-wrap: wrap; justify-content: center;">
                    <!-- Front -->
                    <div class="card-preview-front" style="
                        width: 360px; 
                        height: 220px; 
                        background: linear-gradient(135deg, #2b2e4a 0%, #1a1c29 100%); 
                        border-radius: 16px; 
                        box-shadow: 0 25px 50px rgba(0,0,0,0.4); 
                        position: relative; 
                        overflow: hidden; 
                        color: #fff;
                        font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
                        transition: all 0.4s ease;
                        cursor: pointer;
                        border: 1px solid rgba(255,255,255,0.1);
                    " onmouseover="this.style.transform='scale(1.02) translateY(-5px); box-shadow: 0 30px 60px rgba(0,0,0,0.5);'" onmouseout="this.style.transform='scale(1) translateY(0); box-shadow: 0 25px 50px rgba(0,0,0,0.4);'">
                        
                        <!-- Abstract Shapes/Glow -->
                        <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.08) 0%, transparent 60%); pointer-events: none;"></div>
                        <div style="position: absolute; bottom: -20px; right: -20px; width: 150px; height: 150px; background: rgba(255, 255, 255, 0.05); filter: blur(40px); border-radius: 50%;"></div>

                        <!-- Top Row -->
                        <div style="position: absolute; top: 25px; left: 25px; right: 25px; display: flex; justify-content: space-between; align-items: center; z-index: 2;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                 <!-- Logo Icon -->
                                <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); border-radius: 10px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255,255,255,0.2);">
                                    <span style="font-size: 20px;">🎁</span>
                                </div>
                                <span style="font-size: 18px; font-weight: 600; letter-spacing: 0.5px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">享乐派</span>
                            </div>
                            <div style="font-size: 10px; opacity: 0.7; letter-spacing: 2px; border: 1px solid rgba(255,255,255,0.3); padding: 4px 8px; border-radius: 20px;">VIP ACCESS</div>
                        </div>

                        <!-- Chip -->
                        <div style="position: absolute; top: 85px; left: 25px; width: 45px; height: 35px; background: linear-gradient(135deg, #e0aa3e 0%, #b88a2d 100%); border-radius: 6px; overflow: hidden; z-index: 2; box-shadow: inset 0 1px 0 rgba(255,255,255,0.4);">
                            <!-- Chip contacts (simple lines) -->
                            <div style="width:100%; height:100%; position:relative; opacity:0.6;">
                                <div style="position:absolute; left:0; right:0; top:50%; height:1px; background:#4a3b13;"></div>
                                <div style="position:absolute; top:0; bottom:0; left:33%; width:1px; background:#4a3b13;"></div>
                                <div style="position:absolute; top:0; bottom:0; left:66%; width:1px; background:#4a3b13;"></div>
                                <div style="position:absolute; top:20%; left:20%; right:20%; bottom:20%; border:1px solid #4a3b13; border-radius:2px;"></div>
                            </div>
                        </div>

                        <!-- Bottom Row -->
                        <div style="position: absolute; bottom: 25px; left: 25px; right: 25px; display: flex; justify-content: space-between; align-items: flex-end; z-index: 2;">
                            <div>
                                <div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-bottom: 5px; letter-spacing: 1px;">CARD NUMBER</div>
                                <div style="font-size: 24px; font-family: 'Courier New', monospace; letter-spacing: 3px; font-weight: 700; background: linear-gradient(to bottom, #fff, #ccc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">888888</div>
                            </div>
                            <div style="background: #fff; padding: 4px; border-radius: 8px;">
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://xle.com/gift" style="width: 48px; height: 48px; display: block;" alt="QR">
                            </div>
                        </div>
                    </div>

                    <!-- Back -->
                    <div class="card-preview-back" style="
                        width: 360px; 
                        height: 220px; 
                        background: #1f2024; 
                        border-radius: 16px; 
                        box-shadow: 0 25px 50px rgba(0,0,0,0.2); 
                        position: relative; 
                        overflow: hidden; 
                        color: rgba(255,255,255,0.8);
                        font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
                        transition: all 0.4s ease;
                        cursor: pointer;
                        border: 1px solid rgba(255,255,255,0.05);
                    " onmouseover="this.style.transform='scale(1.02) translateY(-5px); box-shadow: 0 30px 60px rgba(0,0,0,0.3);'" onmouseout="this.style.transform='scale(1) translateY(0); box-shadow: 0 25px 50px rgba(0,0,0,0.2);'">
                        
                        <!-- Instructions -->
                        <div style="padding: 30px 25px; height: 100%; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center;">
                            <div style="font-size: 12px; font-weight: 700; margin-bottom: 12px; color: #fff; letter-spacing: 1px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; width: fit-content;">享乐派惊喜卡使用说明</div>
                            
                            <div style="font-size: 9px; color: #ff6b6b; margin-bottom: 12px; line-height: 1.4; background: rgba(255, 107, 107, 0.1); padding: 6px; border-radius: 4px;">
                                注意：泄露卡片二维码，可能会导致兑换商品的权利被其他人使用
                            </div>

                            <div style="font-size: 9px; line-height: 1.6; color: rgba(255,255,255,0.7);">
                                <div style="display:flex; align-items:flex-start; gap:4px; margin-bottom: 4px;">
                                    <span style="color:#e0aa3e; font-weight:bold; min-width: 10px;">1.</span>
                                    <span>刮开涂层，扫描卡片证明二维码查看商品</span>
                                </div>
                                <div style="display:flex; align-items:flex-start; gap:4px; margin-bottom: 4px;">
                                    <span style="color:#e0aa3e; font-weight:bold; min-width: 10px;">2.</span>
                                    <span>填写收货地址，提交订单，等待商家发货</span>
                                </div>
                                <div style="display:flex; align-items:flex-start; gap:4px; margin-bottom: 4px;">
                                    <span style="color:#e0aa3e; font-weight:bold; min-width: 10px;">3.</span>
                                    <span>您可以扫描二维码，点击订单查看快递单号和快递进度</span>
                                </div>
                                <div style="display:flex; align-items:flex-start; gap:4px;">
                                    <span style="color:#e0aa3e; font-weight:bold; min-width: 10px;">4.</span>
                                    <span>本卡不记名、不挂失，请妥善保管</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 15px; color: #666; font-size: 12px;">( 支持微信扫码直接兑换 )</div>
            </div>

        </div>

    </div>

    <!-- 弹窗组件：批次详情 -->
    <div id="batchDetailModal" class="modal-overlay" onclick="closeModal('batchDetailModal', event)">
        <div class="modal">
            <div class="modal-header">
                <span>批次详情</span>
                <span style="cursor:pointer;" onclick="closeModal('batchDetailModal')">×</span>
            </div>
            <div class="modal-body">
                <div class="admin-card" style="box-shadow:none; padding:0; margin-bottom:15px;">
                    <h4 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">基本信息</h4>
                    <div style="font-size:14px; line-height:2; color:#333;">
                        <div><strong>批次名称：</strong> <span id="bd-batch-name">--</span></div>
                        <div><strong>当前状态：</strong> <span id="bd-status" style="font-weight:bold;">--</span></div>
                        <div><strong>绑定商品：</strong> <span id="bd-product">--</span></div>
                        <div><strong>生成时间：</strong> <span id="bd-create-time">--</span></div>
                        <div><strong>预计发货：</strong> <span id="bd-delivery-time">--</span></div>
                        <div style="margin-top:5px; border-top:1px dashed #eee; padding-top:5px;"><strong>备注信息：</strong> <span id="bd-remark" style="color:#666;">--</span></div>
                    </div>
                </div>
                
                <div class="admin-card" style="box-shadow:none; padding:0;">
                    <h4 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">数据统计</h4>
                    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;">
                        <div style="width:calc(50% - 5px); background:#f9f9f9; padding:10px; border-radius:4px; text-align:center;">
                            <div style="color:#666; font-size:12px;">总卡量</div>
                            <div style="font-size:20px; font-weight:bold; color:var(--primary-color);" id="bd-total-count">0</div>
                        </div>
                        <div style="width:calc(50% - 5px); background:#f9f9f9; padding:10px; border-radius:4px; text-align:center;">
                            <div style="color:#666; font-size:12px;">已激活</div>
                            <div style="font-size:20px; font-weight:bold; color:var(--success-color);" id="bd-activated-count">0</div>
                        </div>
                        <div style="width:calc(50% - 5px); background:#f9f9f9; padding:10px; border-radius:4px; text-align:center;">
                            <div style="color:#666; font-size:12px;">已使用</div>
                            <div style="font-size:20px; font-weight:bold; color:var(--warning-color);" id="bd-used-count">0</div>
                        </div>
                        <div style="width:calc(50% - 5px); background:#f9f9f9; padding:10px; border-radius:4px; text-align:center;">
                            <div style="color:#666; font-size:12px;">已作废</div>
                            <div style="font-size:20px; font-weight:bold; color:var(--danger-color);" id="bd-void-count">0</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('batchDetailModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：修改批次 -->
    <div id="editBatchModal" class="modal-overlay" onclick="closeModal('editBatchModal', event)">
        <div class="modal">
            <div class="modal-header">
                <span>修改批次信息</span>
                <span style="cursor:pointer;" onclick="closeModal('editBatchModal')">×</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-target-btn-id">
                <div class="form-group">
                    <label>批次名称 <span style="color:red">*</span></label>
                    <input type="text" id="edit-batch-name" class="form-control">
                </div>
                <div class="form-group">
                    <label>关联分发商</label>
                    <select id="edit-distributor" class="form-control">
                        <option value="">直营 (无分发商)</option>
                        <option value="dist_c">天沐 (经销)</option>
                        <option value="dist_a">一直娱</option>
                        <option value="dist_b">一直娱 (广州)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>兑换开始时间</label>
                    <input type="datetime-local" id="edit-start-time" class="form-control">
                </div>
                <div class="form-group">
                    <label>预计发货时间</label>
                    <input type="text" id="edit-delivery-time" class="form-control" placeholder="如：2026年1月30日">
                </div>
                <div class="form-group">
                    <label>增加卡片数量 (张)</label>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <input type="number" id="edit-add-quantity" class="form-control" value="0" min="0" placeholder="0" oninput="handleEditQtyChange()">
                        <span style="font-size:12px; color:#666;">(仅允许增加，不可减少)</span>
                    </div>
                    <div style="font-size:12px; color:#e67e22; margin-top:5px;">
                        * 新增卡片将自动继承当前批次的激活状态。
                    </div>
                </div>
                
                <!-- 新增卡号设置 (动态显示) -->
                <div class="form-group" id="edit-card-no-group" style="display:none; background:#f9f9f9; padding:10px; border-radius:4px; margin-bottom: 15px;">
                    <label style="font-size:12px; margin-bottom:5px;">新增卡号规则</label>
                    <div style="margin-bottom:5px;">
                        <label style="font-weight:normal; margin-right:15px; font-size:13px; cursor:pointer;">
                            <input type="radio" name="editCardNoMode" value="auto" checked onclick="toggleEditCardMode(this.value)"> 顺延 (系统生成)
                        </label>
                        <label style="font-weight:normal; font-size:13px; cursor:pointer;">
                            <input type="radio" name="editCardNoMode" value="custom" onclick="toggleEditCardMode(this.value)"> 自定义起始号
                        </label>
                    </div>
                    <div id="editCardNoRangeBox" style="display:none; margin-top:5px; align-items:center;">
                        <span style="color:#666; font-size:12px; margin-right:5px;">起始号 NO.</span>
                        <input type="number" id="editStartCardNo" class="form-control" style="width:100px; padding:2px 5px; height:28px; display:inline-block;" placeholder="1" oninput="calcEditCardRange()">
                        <span style="margin:0 5px; color:#999; font-size:12px;">至 NO.<span id="editEndCardNo">--</span></span>
                    </div>
                    <div id="editCardNoAutoTip" style="font-size:12px; color:#666; margin-top:5px;">
                        预计卡号段：<span id="editAutoRange">--</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>备注信息</label>
                    <textarea id="edit-remark" class="form-control" rows="4" style="width: 100%; resize: vertical;" placeholder="备注信息..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editBatchModal')">取消</button>
                <button class="btn btn-primary" onclick="submitEditBatch()">保存修改</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：新增/编辑分发商 -->
    <div id="editDistributorModal" class="modal-overlay" onclick="closeModal('editDistributorModal', event)">
        <div class="modal">
            <div class="modal-header">
                <span id="distributor-modal-title">新增分发商</span>
                <span style="cursor:pointer;" onclick="closeModal('editDistributorModal')">×</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="distributor-id">
                <div class="form-group">
                    <label>分发商名称 <span style="color:red">*</span></label>
                    <input type="text" id="distributor-name" class="form-control" placeholder="请输入公司或个人名称">
                </div>
                <div class="form-group">
                    <label>分发商类型 <span style="color:red">*</span></label>
                    <div style="margin-top:5px;">
                        <label style="font-weight:normal; margin-right:20px; cursor:pointer;">
                            <input type="radio" name="distributorType" value="self_operated" checked> 自营 (直销)
                        </label>
                        <label style="font-weight:normal; margin-right:20px; cursor:pointer;">
                            <input type="radio" name="distributorType" value="distribution"> 分销 (代销/返佣)
                        </label>
                        <label style="font-weight:normal; margin-right:20px; cursor:pointer;">
                            <input type="radio" name="distributorType" value="dealership"> 经销 (买断/批发)
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>联系人 <span style="color:red">*</span></label>
                    <input type="text" id="distributor-contact" class="form-control" placeholder="请输入联系人姓名">
                </div>
                <div class="form-group">
                    <label>联系电话 <span style="color:red">*</span></label>
                    <input type="text" id="distributor-phone" class="form-control" placeholder="请输入手机号或座机">
                </div>
                
                <div style="background:#f9f9f9; padding:10px; border-radius:4px; margin-bottom:15px; border:1px solid #eee;">
                    <div style="font-size:12px; font-weight:bold; margin-bottom:10px; color:#666;">开票信息 (选填)</div>
                    <div class="form-group" style="margin-bottom:10px;">
                        <label style="font-size:12px; font-weight:normal;">纳税人识别号</label>
                        <input type="text" id="distributor-tax-id" class="form-control" placeholder="请输入税号" style="font-size:13px;">
                    </div>
                    <div class="form-group" style="margin-bottom:10px;">
                        <label style="font-size:12px; font-weight:normal;">开户银行</label>
                        <input type="text" id="distributor-bank" class="form-control" placeholder="请输入开户行名称" style="font-size:13px;">
                    </div>
                    <div class="form-group" style="margin-bottom:0;">
                        <label style="font-size:12px; font-weight:normal;">银行账号</label>
                        <input type="text" id="distributor-account" class="form-control" placeholder="请输入银行账号" style="font-size:13px;">
                    </div>
                </div>

                <div class="form-group">
                    <label>联系地址</label>
                    <textarea id="distributor-address" class="form-control" rows="3" style="width: 100%; resize: vertical;" placeholder="请输入详细地址"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('editDistributorModal')">取消</button>
                <button class="btn btn-primary" onclick="saveDistributor()">保存</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：新增制卡 -->
    <div id="createCardModal" class="modal-overlay" onclick="closeModal('createCardModal', event)">
        <div class="modal" style="width: 650px;">
            <div class="modal-header">
                <span>新增制卡任务</span>
                <span style="cursor:pointer;" onclick="closeModal('createCardModal')">×</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>批次名称 <span style="color:red">*</span></label>
                    <input type="text" class="form-control" placeholder="例如：2023中秋企业采购_A批次">
                </div>
                
                <!-- 卡片类型选择 -->
                <div class="form-group">
                    <label>卡片类型</label>
                    <div style="margin-top:5px;">
                        <label style="font-weight:normal; margin-right:20px; cursor:pointer;">
                            <input type="radio" name="cardType" value="product" checked onclick="toggleCardType(this.value)"> 商品兑换卡
                        </label>
                        <label style="font-weight:normal; cursor:pointer;">
                            <input type="radio" name="cardType" value="points" onclick="toggleCardType(this.value)"> 积分礼品卡
                        </label>
                    </div>
                </div>

                <!-- 场景2：积分卡配置 -->
                <div id="type-points-config" class="form-group" style="display:none;">
                    <label>积分面额 <span style="color:red">*</span></label>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <input type="number" id="card-points" class="form-control" placeholder="如 300" style="width:150px;">
                        <span style="color:#666;">积分 (1积分=1元)</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>关联分发商与结算折扣</label>
                    <div style="background: #f9f9f9; padding: 15px; border-radius: 4px; border: 1px solid #eee;">
                        <div style="display:flex; gap:15px; align-items:flex-start;">
                            <div style="width: 280px;">
                                <label style="font-size:12px; color:#666; margin-bottom:5px; display:block; font-weight:normal;">选择分发商</label>
                                <select class="form-control" style="width:100%;" id="create-card-distributor" onchange="handleDistributorChange(this)">
                                    <option value="">请选择分发商...</option>
                                    <option value="dist_c">天沐 (经销)</option>
                                    <option value="dist_a">一直娱</option>
                                    <option value="dist_b">一直娱 (广州)</option>
                                </select>
                            </div>
                            <div style="width:140px;" id="discount-rate-group">
                                <label style="font-size:12px; color:#666; margin-bottom:5px; display:block; font-weight:normal;">本批次折扣率 (%)</label>
                                <div style="position:relative;">
                                    <input type="number" class="form-control" placeholder="如 70" value="70" style="padding-right: 25px;">
                                    <span style="position:absolute; right:10px; top:50%; transform:translateY(-50%); color:#999; font-size:12px;">%</span>
                                </div>
                            </div>
                            <div style="width:140px; display:none;" id="channel-fee-rate-group">
                                <label style="font-size:12px; color:#666; margin-bottom:5px; display:block; font-weight:normal;">渠道费率 (%)</label>
                                <div style="position:relative;">
                                    <input type="number" id="channel-fee-rate" class="form-control" placeholder="如 5" value="5" style="padding-right: 25px;">
                                    <span style="position:absolute; right:10px; top:50%; transform:translateY(-50%); color:#999; font-size:12px;">%</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 12px; color: #999; line-height: 1.4;" id="discount-rate-tip">
                            * 设置折扣率后，系统将按 <code>实际发货商品价值 × 折扣率</code> 自动计算应结算金额。
                        </div>
                        <div style="margin-top: 8px; font-size: 12px; color: #999; line-height: 1.4; display:none;" id="channel-fee-tip">
                            * 设置渠道费率后，结算时将自动计算：<code>本次结算渠道费 = 本次结算金额 × 渠道费率</code>。
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>制卡数量 (张) <span style="color:red">*</span></label>
                    <input type="number" id="card-quantity" class="form-control" value="100" oninput="calcCardRange()">
                </div>
                <div class="form-group">
                    <label>卡号设置</label>
                    <div style="margin-top:5px;">
                        <label style="font-weight:normal; margin-right:20px; cursor:pointer;">
                            <input type="radio" name="cardNoMode" value="auto" checked onclick="toggleCardMode(this.value)"> 默认 (系统生成)
                        </label>
                        <label style="font-weight:normal; cursor:pointer;">
                            <input type="radio" name="cardNoMode" value="custom" onclick="toggleCardMode(this.value)"> 自定义号段
                        </label>
                    </div>
                    <div id="cardNoRangeBox" style="display:none; margin-top:10px; align-items:center; background:#f9f9f9; padding:10px; border-radius:4px;">
                        <span style="color:#666; font-size:13px; margin-right:10px;">起始号 NO.</span>
                        <input type="number" id="startCardNo" class="form-control" style="width:120px; display:inline-block;" placeholder="1" value="1" oninput="calcCardRange()">
                        <span style="margin:0 10px; color:#999;">至</span>
                        <span style="font-weight:bold;">NO. <span id="endCardNo">100</span></span>
                    </div>
                </div>
                <div id="time-setting-group" class="form-group">
                    <label>时间设置</label>
                    <div style="display:flex; gap:10px; flex-wrap:wrap; background:#f9f9f9; padding:10px; border-radius:4px;">
                        <div style="flex:1; min-width:130px;">
                            <label style="font-size:12px; color:#666; font-weight:normal; display:block; margin-bottom:5px;">兑换开始时间</label>
                            <input type="datetime-local" id="create-start-time" class="form-control" style="font-size:12px; width:100%; box-sizing:border-box;">
                        </div>
                        <div style="flex:1; min-width:130px;">
                            <label style="font-size:12px; color:#666; font-weight:normal; display:block; margin-bottom:5px;">预计发货时间 (文本描述)</label>
                            <input type="text" id="create-delivery-time" class="form-control" style="font-size:12px; width:100%; box-sizing:border-box;" placeholder="如：2026年1月30日">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div style="margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <label style="font-weight: 500;">备注信息</label>
                        <span style="font-size: 12px; color: #999;">（仅内部可见，不展示给用户）</span>
                    </div>
                    <textarea id="create-remark" class="form-control" rows="4" style="width: 100%; resize: vertical; min-height: 80px; line-height: 1.6;" placeholder="在此输入备注信息，例如：2023中秋企业采购订单、大客户定制需求等（可选填）"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createCardModal')">取消</button>
                <button class="btn btn-primary" onclick="submitCreateCard()">确认生成</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：订单详情 -->
    <div id="orderDetailModal" class="modal-overlay" onclick="closeModal('orderDetailModal', event)">
        <div class="modal" style="width: 600px;">
            <div class="modal-header">
                <span>订单详情</span>
                <span style="cursor:pointer;" onclick="closeModal('orderDetailModal')">×</span>
            </div>
            <div class="modal-body">
                <!-- 基础信息 -->
                <div style="background:#f8f9fa; padding:15px; border-radius:4px; margin-bottom:20px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="color:#666;">订单编号：</span>
                        <span style="font-weight:bold;">ORD-20231026-055</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="color:#666;">下单时间：</span>
                        <span>2023-10-26 14:30:22</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:#666;">当前状态：</span>
                        <span class="tag p2">已发货</span>
                    </div>
                </div>

                <!-- 商品信息 -->
                <div class="form-group">
                    <label style="border-bottom:1px solid #eee; padding-bottom:5px; margin-bottom:10px;">商品信息</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <div style="width:50px; height:50px; background:#eee; border-radius:4px;"></div>
                        <div>
                            <div style="font-weight:bold;">坚果大礼包</div>
                            <div style="color:#999; font-size:12px;">规格：默认 x 1</div>
                        </div>
                    </div>
                </div>

                <!-- 收货信息 -->
                <div class="form-group">
                    <label style="border-bottom:1px solid #eee; padding-bottom:5px; margin-bottom:10px;">收货信息</label>
                    <div style="font-size:13px; line-height:1.8;">
                        <div><span style="color:#666; width:70px; display:inline-block;">收货人：</span>李四</div>
                        <div><span style="color:#666; width:70px; display:inline-block;">联系电话：</span>13900000000</div>
                        <div><span style="color:#666; width:70px; display:inline-block;">收货地址：</span>上海市浦东新区张江高科园区xx路xx号</div>
                    </div>
                </div>

                <!-- 物流信息 -->
                <div class="form-group">
                    <label style="border-bottom:1px solid #eee; padding-bottom:5px; margin-bottom:10px;">物流跟踪</label>
                    <div style="background:#f0f7ff; padding:10px; border-radius:4px; border:1px solid #cce5ff;">
                        <div style="font-weight:bold; color:#0056b3; margin-bottom:5px;">顺丰速运: SF1234567890</div>
                        <div style="font-size:12px; color:#666;">
                            <div>2023-10-27 09:00:00 [上海市] 快件派送中...</div>
                            <div style="margin-top:5px;">2023-10-26 20:00:00 [上海市] 快件到达集散中心</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('orderDetailModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：激活确认 -->
    <div id="activateConfirmModal" class="modal-overlay" onclick="closeModal('activateConfirmModal', event)">
        <div class="modal" style="width: 400px;">
            <div class="modal-header">
                <span>激活确认</span>
                <span style="cursor:pointer;" onclick="closeModal('activateConfirmModal')">×</span>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 48px; color: var(--warning-color); margin-bottom: 15px;">⚠️</div>
                    <p style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">确认激活该批次卡片吗？</p>
                    <p style="color: #666; font-size: 14px;">激活后卡片将可以被用户兑换使用。<br>此操作不可撤销。</p>
                </div>
            </div>
            <div class="modal-footer">
                <input type="hidden" id="activate-target-btn-id">
                <button class="btn btn-outline" onclick="closeModal('activateConfirmModal')">取消</button>
                <button class="btn btn-primary" onclick="confirmActivate()">确认激活</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：开票操作 -->
    <div id="invoiceModal" class="modal-overlay" onclick="closeModal('invoiceModal', event)">
        <div class="modal">
            <div class="modal-header">
                <span>开票登记</span>
                <span style="cursor:pointer;" onclick="closeModal('invoiceModal')">×</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="invoice-target-id">
                
                <!-- 关联的开票信息展示 -->
                <div style="background:#f0f7ff; border:1px solid #cce5ff; padding:10px; border-radius:4px; margin-bottom:15px; font-size:12px; color:#004085;">
                    <div style="font-weight:bold; margin-bottom:5px;">客户开票信息：</div>
                    <div id="invoice-customer-info" style="line-height:1.6;">
                        <!-- 动态填充 -->
                        暂无关联信息
                    </div>
                </div>

                <div class="form-group">
                    <label>本次开票金额 <span style="color:red">*</span></label>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <input type="number" id="invoice-amount" class="form-control" placeholder="0.00" oninput="validateInvoiceAmount()">
                        <span style="font-size:12px; color:#666;">(未开票余额: <span id="invoice-remain-amount" style="color:#e74c3c;">0.00</span>)</span>
                    </div>
                    <div id="invoice-amount-error" style="color:red; font-size:12px; display:none; margin-top:5px;">开票金额不能超过未开票余额</div>
                </div>
                <div class="form-group">
                    <label>发票号码 <span style="color:red">*</span></label>
                    <input type="text" id="invoice-number" class="form-control" placeholder="请输入发票号码">
                </div>
                <div class="form-group">
                    <label>开票日期</label>
                    <input type="date" id="invoice-date" class="form-control">
                </div>
                <div class="form-group">
                    <label>发票附件</label>
                    <input type="file" id="invoice-attachment" class="form-control" style="padding: 3px;">
                    <div style="font-size:12px; color:#999; margin-top:5px;">支持 JPG, PNG, PDF 格式</div>
                </div>
                <div class="form-group">
                    <label>备注</label>
                    <textarea id="invoice-remark" class="form-control" rows="5" style="resize: vertical;" placeholder="请输入备注信息..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('invoiceModal')">取消</button>
                <button class="btn btn-primary" onclick="submitInvoice()">确认开票</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：开票明细 -->
    <div id="invoiceDetailModal" class="modal-overlay" onclick="closeModal('invoiceDetailModal', event)">
        <div class="modal" style="width: 600px;">
            <div class="modal-header">
                <span>开票明细记录</span>
                <span style="cursor:pointer;" onclick="closeModal('invoiceDetailModal')">×</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom:15px; background:#f9f9f9; padding:10px; border-radius:4px;">
                    <div style="font-size:14px; color:#666;">关联收款记录：<span id="detail-invoice-ref" style="font-weight:bold; color:#333;">--</span></div>
                    <div style="display:flex; gap:20px; margin-top:5px; font-size:13px;">
                        <div>实收总额: <span id="detail-total-amount" style="font-weight:bold;">¥ 0.00</span></div>
                        <div>已开票: <span id="detail-invoiced-amount" style="color:#27ae60; font-weight:bold;">¥ 0.00</span></div>
                    </div>
                </div>
                
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>开票日期</th>
                            <th>发票号码</th>
                            <th>金额</th>
                            <th>备注</th>
                            <th>操作人</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-history-list">
                        <!-- 动态填充 -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('invoiceDetailModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：新增发卡记录 -->
    <div id="createIssuanceModal" class="modal-overlay" onclick="closeModal('createIssuanceModal', event)">
        <div class="modal">
            <div class="modal-header">
                <span>新增发卡记录</span>
                <span style="cursor:pointer;" onclick="closeModal('createIssuanceModal')">×</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>选择分发商 <span style="color:red">*</span></label>
                    <select id="issuance-distributor" class="form-control">
                        <option value="">请选择...</option>
                        <option value="d0">享乐派直营 (自营)</option>
                        <option value="d1">一直娱 (分销)</option>
                        <option value="d2">一直娱 (广州) (分销)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>选择卡片批次 <span style="color:red">*</span></label>
                    <select id="issuance-batch" class="form-control">
                        <option value="">请选择...</option>
                        <option value="b1">周杰伦新专辑_自营 (剩余: 500)</option>
                        <option value="b2">周杰伦新专辑_杭州线下 (剩余: 200)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>发卡数量 <span style="color:red">*</span></label>
                    <input type="number" id="issuance-quantity" class="form-control" placeholder="输入数量">
                </div>
                <div class="form-group">
                    <label>单张面额/价值 <span style="color:red">*</span></label>
                    <input type="number" id="issuance-price" class="form-control" placeholder="输入单价" value="300">
                </div>
                <div class="form-group">
                    <label>发卡日期 <span style="color:red">*</span></label>
                    <input type="date" id="issuance-date" class="form-control">
                </div>
                <div class="form-group">
                    <label>备注</label>
                    <textarea id="issuance-remark" class="form-control" rows="2"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createIssuanceModal')">取消</button>
                <button class="btn btn-primary" onclick="saveIssuance()">保存</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：新增结算记录 -->
    <div id="createSettlementModal" class="modal-overlay" onclick="closeModal('createSettlementModal', event)">
        <div class="modal">
            <div class="modal-header">
                <span>新增结算记录</span>
                <span style="cursor:pointer;" onclick="closeModal('createSettlementModal')">×</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="settlement-ref-id">
                <div class="form-group" style="background:#f9f9f9; padding:10px; border-radius:4px; margin-bottom:15px;">
                    <div style="font-size:12px; color:#666;">当前关联记录：</div>
                    <div id="settlement-ref-text" style="font-weight:bold; margin-top:5px;">--</div>
                </div>
                <div class="form-group">
                    <label>本次结算金额 <span style="color:red">*</span></label>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <input type="number" id="settlement-amount" class="form-control" placeholder="0.00">
                        <span style="font-size:12px; color:#666;">元</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>本次结算渠道费 <span style="color:red">*</span></label>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <input type="number" id="settlement-fee" class="form-control" placeholder="0.00">
                        <span style="font-size:12px; color:#666;">元</span>
                    </div>
                    <div style="font-size:12px; color:#999; margin-top:5px;">* 渠道费包含返佣、服务费等</div>
                </div>
                <div class="form-group">
                    <label>渠道费用发票附件</label>
                    <input type="file" id="settlement-attachment" class="form-control" style="padding: 3px;">
                    <div style="font-size:12px; color:#999; margin-top:5px;">支持 JPG, PNG, PDF 格式</div>
                </div>
                <div class="form-group">
                    <label>结算日期</label>
                    <input type="date" class="form-control" value="2023-10-27">
                </div>
                <div class="form-group">
                    <label>凭证/备注</label>
                    <textarea id="settlement-remark" class="form-control" rows="4" style="resize: vertical;" placeholder="请输入备注信息..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createSettlementModal')">取消</button>
                <button class="btn btn-primary" onclick="saveSettlement()">确认结算</button>
            </div>
        </div>
    </div>

    <!-- 弹窗组件：新增收款 -->
    <div id="createIncomeModal" class="modal-overlay" onclick="closeModal('createIncomeModal', event)">
        <div class="modal">
            <div class="modal-header">
                <span>新增订单</span>
                <span style="cursor:pointer;" onclick="closeModal('createIncomeModal')">×</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>订单日期 <span style="color:red">*</span></label>
                    <input type="date" id="income-date" class="form-control">
                </div>
                <div class="form-group">
                    <label>客户名称 <span style="color:red">*</span></label>
                    <div style="display: flex; gap: 10px;">
                        <select id="income-customer-select" class="form-control" onchange="toggleCustomerInput(this)">
                            <option value="">请选择...</option>
                            <option value="d3">天沐 (经销)</option>
                            <option value="d1">一直娱 (分销)</option>
                            <option value="d2">一直娱 (广州) (分销)</option>
                            <option value="custom">其他 (手动输入)</option>
                        </select>
                        <input type="text" id="income-customer-input" class="form-control" placeholder="输入客户名称" style="display: none;">
                    </div>
                </div>
                <div class="form-group">
                    <label>卡片批次 <span style="color:red">*</span></label>
                    <select id="income-batch" class="form-control">
                        <option value="">请选择...</option>
                        <option value="b1">周杰伦新专辑_自营</option>
                        <option value="b2">周杰伦新专辑_杭州线下</option>
                        <option value="b3">周杰伦新专辑_北京线下</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>购买数量 (张) <span style="color:red">*</span></label>
                    <input type="number" id="income-quantity" class="form-control" placeholder="输入数量">
                </div>
                <div class="form-group">
                    <label>实收金额 <span style="color:red">*</span></label>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <input type="number" id="income-amount" class="form-control" placeholder="0.00">
                        <span style="font-size:12px; color:#666;">元</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('createIncomeModal')">取消</button>
                <button class="btn btn-primary" onclick="saveIncome()">保存</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>